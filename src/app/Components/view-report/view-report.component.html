<div class="container" [class.active]="expandReport" [style.opacity]="isLoading ? 0.5 : 1">
  <div class="nav">
    <div
      class="back"
      (click)="goBack()"
      [style.background-color]="
        projectViewService.expandReport ? 'inherit' : 'var(--sibasiGrey)'
      "
    >
      <i
        [style.display]="projectViewService.expandReport ? 'none' : 'block'"
        class="pi pi-arrow-circle-left"
      ></i>
    </div>
    <div class="maximize" (click)="toggle()">
      <i
        class="pi"
        [ngClass]="{
          'pi-window-maximize': !expandReport,
          'pi-window-minimize': expandReport
        }"
      ></i>
    </div>
  </div>
  <div class="doc">
    <div class="cover">
      <div class="project-details">
        <div class="head">
          <span>Project Information</span>
        </div>
        <div class="details">
          <div class="dets">
            <label htmlfor="name">Project Name</label>
            <input id="name" type="text" [value]="project?.name" />
          </div>
          <div class="dets">
            <label htmlfor="date">Date Created</label>
            <p-datepicker
              [styleClass]="'date-ng'"
              [(ngModel)]="date"
              [showIcon]="true"
              inputId="buttondisplay"
              [showOnFocus]="false"
              disabled="true"
            />
          </div>
          <div class="dets">
            <label htmlfor="project-description">Description</label>
            <div class="editor-wrapper" style="text-align: left">
              <div
                id="project-description"
                class="editor-container"
                style="text-align: left"
              ></div>
            </div>
            <div>
              <button class="update-btn">
                <i class="pi pi-pencil"></i>
                <span>Edit details</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="severity">
        <div class="severity-container">
          <div
            class="severity-item"
            style="color: #dc3545; box-shadow: 0 0 2px #dc3545"
          >
            <i class="pi pi-exclamation-circle"></i>
            <span>Critical</span>
            <span>{{ critical }}</span>
          </div>
          <div
            class="severity-item"
            style="color: #fd7e14; box-shadow: 0 0 2px #fd7e14"
          >
            <i class="pi pi-exclamation-triangle"></i>
            <span>High</span>
            <span>{{ high }}</span>
          </div>
        </div>
        <div class="severity-container">
          <div
            class="severity-item"
            style="color: #ffc107; box-shadow: 0 0 2px #ffc107"
          >
            <i class="pi pi-info-circle"></i>
            <span>Medium</span>
            <span>{{ medium }}</span>
          </div>
          <div
            class="severity-item"
            style="color: #28a745; box-shadow: 0 0 2px #28a745"
          >
            <i class="pi pi-check-circle"></i>
            <span>Low</span>
            <span>{{ low }}</span>
          </div>
        </div>
      </div>
      <div class="findings">
        <div class="head">
          <span>Findings</span>
          <button class="add-btn">
            <i class="pi pi-plus"></i>
            <span>Add finding</span>
          </button>
        </div>
        <div>
            <div class="findings-container" *ngFor="let finding of project?.findings; let i = index">
                <div class="finding-head">
                    <div class="labels">
                        <div class="label-1">
                            <span>{{finding?.severity || 'Medium'}}</span>
                        </div>
                        <div class="label-2">
                            <span>Functional</span> 
                        </div>
                    </div>
                    <div>
                        <i class="pi pi-trash"></i>
                    </div>
                </div>
                
                <div class="title">
                    <label for="title-{{i}}">Title</label>
                    <input id="title-{{i}}" [value]="finding?.title" type="text" placeholder="Enter title">
                </div>
                
                <div class="severity-select">
                    <div class="select-container">
                        <label for="severity-{{i}}">Severity</label>
                        <select name="severity" [value]="finding?.severity" id="severity-{{i}}">
                            <option value="Critical">Critical</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div class="select-container">
                        <label for="type-{{i}}">Type</label>
                        <select name="type" id="type-{{i}}">
                            <option *ngFor="let category of categories" [value]="category.id">
                                {{ category.name }}
                            </option>
                        </select>
                    </div>
                </div>
                
                <div class="description">
                    <label for="finding-description-{{i}}">Description</label>
                    <!-- Each finding gets its own editor -->
                    <div class="editor-wrapper" style="text-align: left;">
                        <div id="finding-description-{{i}}" class="editor-container" style="text-align: left;"></div>
                    </div>
                </div>
            </div>
          <div *ngIf="!project?.findings || project?.findings.length === 0">
            <div class="findings-container">
              <div class="finding-head">
                <div class="labels">
                  <div class="label-1">
                    <span>Medium</span>
                  </div>
                  <div class="label-2">
                    <span>Functional</span>
                  </div>
                </div>
                <div>
                  <i class="pi pi-trash"></i>
                </div>
              </div>
              <div class="title">
                <label for="title-empty">Title</label>
                <input id="title-empty" type="text" placeholder="Enter title" />
              </div>
              <div class="severity-select">
                <div class="select-container">
                  <label for="severity-empty">Severity</label>
                  <select name="severity" id="severity-empty">
                    <option value="">Select severity</option>
                    <option value="Critical">Critical</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                  </select>
                </div>
                <div class="select-container">
                  <label for="type-empty">Category</label>
                  <select name="type" id="type-empty">
                    <option value="">Select category</option>
                    <option
                      *ngFor="let category of categories"
                      [value]="category.id"
                    >
                      {{ category.name }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="description">
                <label for="finding-description-empty">Description</label>
                <div class="editor-wrapper" style="text-align: left;">
                    <div id="finding-description-empty" class="editor-container" style="text-align: left;"></div>
                </div>
              </div>
              <button class="update-btn" style="margin-top: 70px; width: fit-content;">
                <i class="pi pi-save"></i>
                <span>Save finding</span>
              </button>
            </div>

            
          </div>
        </div>
      </div>

      <button class="update-btn" style="margin-top: 70px">
        <i class="pi pi-plus"></i>
        <span>View report</span>
      </button>
    </div>
  </div>

  <app-loading *ngIf="isLoading"></app-loading>
</div>
